<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blueGemstone.dao.PublicMapper">
	<select id="getVarChangeAvgValue" resultType="java.lang.Float">
		select avg(value) value from VarChange where name=#{name} and createTime&lt;#{time} and updated=0
	</select>
	<select id="selectVarChangeLineData" resultType="blueGemstone.entity.VarChange">
		select convert(varchar(12),CreateTime,108) createTime,value from VarChange where name=#{name} order by createtime
	</select>
	<select id="selectVarChangeReportData" resultType="blueGemstone.entity.VarChange">
		select name,convert(varchar,CreateTime,120) createTime,value,state from VarChange where 1=1
		<if test="name!=null">
			and name=#{name}
		</if>
		order by name,createtime
	</select>
	<select id="selectVarAvgChangeLineData" resultType="blueGemstone.entity.VarAvgChange">
		select convert(varchar(12),CreateTime,108) createTime,value from VarAvgChange where name=#{name} order by createtime
	</select>
	<select id="selectWarnRecordReportData" resultType="blueGemstone.entity.WarnRecord">
		select convert(varchar,CreateTime,120) createTime,value,state from WarnRecord order by createtime
	</select>
	<insert id="insertVarChange" parameterType="blueGemstone.entity.VarChange">
		insert into VarChange (id,name,value,createTime,state,updated,memo) values(#{id},#{name},#{value},#{createTime},#{state},0,#{memo})
	</insert>
	<insert id="insertVarAvgChange" parameterType="blueGemstone.entity.VarAvgChange">
		insert into VarAvgChange (id,name,value,createTime,state,memo) values(#{id},#{name},#{value},#{createTime},#{state},#{memo})
	</insert>
	<insert id="insertWarnRecord" parameterType="blueGemstone.entity.WarnRecord">
		insert into WarnRecord (id,name,value,createTime,state,memo) values(#{id},#{name},#{value},#{createTime},#{state},#{memo})
	</insert>
	<update id="updateVarChange">
		update VarChange set updated=1 where name=#{name} and createTime&lt;#{time} and updated=0
	</update>
</mapper>